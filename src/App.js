import React, { Component } from 'react';
import Gantt from './Gantt';
import Toolbar from './Toolbar';
import MessageArea from './MessageArea';
import './App.css';

let data = 
  {"data":[{"id":1,"text":"DESIGN WORKS","description":"","duration":549,"progress":0.23,"start_date":"2019-04-01 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-19 09:03:17.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":2,"text":"Interior design project (Contractor\u0027s commitment)","description":"","duration":123,"progress":0.16,"start_date":"2019-08-01 00:00:00","parent":1,"owner":"Aleksandrs","timestamps":{"date":"2019-02-26 15:08:44.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":3,"text":"Preparation of design work","description":null,"duration":0,"progress":0.12,"start_date":"2019-08-01 00:00:00","parent":1,"owner":"Aleksandrs","timestamps":{"date":"2019-02-11 20:25:20.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":7,"text":"Ventilation","description":"","duration":0,"progress":0.1,"start_date":"2020-01-01 00:00:00","parent":1,"owner":"Aleksandrs","timestamps":{"date":"2019-02-18 09:45:14.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":9,"text":"Electrical installation","description":null,"duration":197,"progress":0,"start_date":"2020-02-01 00:00:00","parent":1,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 16:26:56.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":10,"text":"Weak flow","description":"","duration":122,"progress":0.02,"start_date":"2020-06-01 00:00:00","parent":1,"owner":"Aleksandrs","timestamps":{"date":"2019-02-12 12:01:01.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":11,"text":"Preparatory work","description":"","duration":568,"progress":0.27,"start_date":"2019-04-01 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-18 15:04:06.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":12,"text":"Excavation works","description":null,"duration":273,"progress":0,"start_date":"2019-05-01 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 16:28:37.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":13,"text":"Foundations and Bases","description":null,"duration":211,"progress":0,"start_date":"2019-09-18 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":14,"text":"Brickwork","description":null,"duration":308,"progress":0,"start_date":"2019-11-20 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":15,"text":"Fill under the floor","description":null,"duration":249,"progress":0,"start_date":"2019-11-27 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":16,"text":"Light panels instalation","description":null,"duration":217,"progress":0,"start_date":"2019-11-27 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":17,"text":"Roof works","description":null,"duration":292,"progress":0,"start_date":"2019-12-11 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":18,"text":"Openings at the outer borders","description":null,"duration":300,"progress":0,"start_date":"2019-12-25 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":19,"text":"Flooring construction","description":null,"duration":281,"progress":0,"start_date":"2019-12-04 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":20,"text":"Walls","description":null,"duration":239,"progress":0,"start_date":"2019-04-01 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 16:28:40.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":21,"text":"Facade cassettes and facade boards installation","description":null,"duration":220,"progress":0,"start_date":"2019-05-01 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 16:28:45.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":22,"text":"Interior decoration","description":null,"duration":321,"progress":0,"start_date":"2019-06-01 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 16:28:43.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":23,"text":"Special works","description":null,"duration":292,"progress":0,"start_date":"2019-12-11 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":24,"text":"Post-construction work","description":null,"duration":254,"progress":0,"start_date":"2019-04-30 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":25,"text":"Outdoor construction","description":null,"duration":20,"progress":0,"start_date":"2019-10-01 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":26,"text":"Road, area construction and landscaping","description":null,"duration":312,"progress":0,"start_date":"2019-09-18 00:00:00","parent":11,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":27,"text":"Scaffolding assembly","description":null,"duration":428,"progress":0,"start_date":"2019-10-23 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":28,"text":"Post assembly","description":null,"duration":289,"progress":0,"start_date":"2019-10-23 00:00:00","parent":27,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":29,"text":"Assembling of rails","description":null,"duration":320,"progress":0,"start_date":"2019-10-30 00:00:00","parent":27,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":30,"text":"Mounting of hollow panels","description":null,"duration":307,"progress":0,"start_date":"2019-11-06 00:00:00","parent":27,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":31,"text":"Steel structures","description":null,"duration":252,"progress":0,"start_date":"2019-11-20 00:00:00","parent":27,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":32,"text":"Squares","description":null,"duration":277,"progress":0,"start_date":"2019-11-20 00:00:00","parent":27,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":33,"text":"REPLY AND USE","description":"","duration":37,"progress":0,"start_date":"2019-04-01 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-12 12:58:10.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":34,"text":"Transmission process to the customer","description":null,"duration":100,"progress":0,"start_date":"2019-05-18 00:00:00","parent":33,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":35,"text":"Basic availability","description":null,"duration":124,"progress":0.27,"start_date":"2019-05-11 00:00:00","parent":33,"owner":"Aleksandrs","timestamps":{"date":"2019-02-07 16:42:20.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":36,"text":"Application for authorization for use","description":null,"duration":180,"progress":0,"start_date":"2019-04-30 00:00:00","parent":33,"owner":"Aleksandrs","timestamps":{"date":"2019-02-08 02:25:43.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":37,"text":"Issue of an Orienteering Authorization","description":null,"duration":80,"progress":0,"start_date":"2019-06-08 00:00:00","parent":33,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":38,"text":"Installation of the furnishings \/ Contractor\u0027s work","description":null,"duration":57,"progress":0,"start_date":"2019-09-01 00:00:00","parent":33,"owner":"Aleksandrs","timestamps":{"date":"2019-02-01 15:58:16.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":43,"text":"New taskhghhj","description":"","duration":1,"progress":1,"start_date":"2019-03-01 00:00:00","parent":2,"owner":"Aleksandrs","timestamps":{"date":"2019-02-18 09:47:29.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":44,"text":"ACTIVITY TITLE222","description":null,"duration":175,"progress":0.35,"start_date":"2019-07-10 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-06 15:35:06.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":7,"team_managers":[1,3],"subcontractor":2,"subcontractor_managers":[12,7,9],"open":true},{"id":45,"text":"ACTIVITY TITLE777","description":null,"duration":458,"progress":0.35,"start_date":"2019-09-01 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-06 15:37:24.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":7,"team_managers":[1,3],"subcontractor":2,"subcontractor_managers":[12,7,9],"open":true},{"id":46,"text":"NEW ACTIVITY TITLE","description":null,"duration":72,"progress":0.8,"start_date":"2019-08-05 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-08 13:48:26.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":7,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":47,"text":"ACTIVITY TITLE777","description":null,"duration":25,"progress":0.35,"start_date":"2019-07-10 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-08 13:47:43.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":7,"team_managers":[1,3],"subcontractor":2,"subcontractor_managers":[12,7,9],"open":true},{"id":48,"text":"NEW ACTIVITY TITLE9234234","description":"","duration":0,"progress":1,"start_date":"2019-08-05 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-12 12:11:04.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":7,"team_managers":[1,3],"subcontractor":2,"subcontractor_managers":[12,7,9],"open":true},{"id":50,"text":"New task","description":null,"duration":0,"progress":0,"start_date":"2019-04-01 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-12 12:08:10.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":51,"text":"New task","description":null,"duration":0,"progress":0.25,"start_date":"2019-04-01 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-12 12:09:01.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":52,"text":"New task","description":null,"duration":7,"progress":0.25,"start_date":"2019-04-01 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-12 12:09:39.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":53,"text":"New task","description":null,"duration":0,"progress":0.25,"start_date":"2019-04-01 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-12 12:09:53.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":54,"text":"New task","description":"","duration":1,"progress":1,"start_date":"2019-04-01 00:00:00","parent":1,"owner":"Aleksandrs","timestamps":{"date":"2019-02-26 15:07:22.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":55,"text":"Exterior Design","description":"","duration":92,"progress":1,"start_date":"2019-06-01 00:00:00","parent":1,"owner":"Aleksandrs","timestamps":{"date":"2019-02-18 15:03:56.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":56,"text":"Interior design project (Contractor\u0027s commitment) Copy","description":"","duration":206,"progress":0,"start_date":"2019-09-01 00:00:00","parent":1,"owner":"Aleksandrs","timestamps":{"date":"2019-02-18 15:04:02.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true},{"id":57,"text":"New task","description":null,"duration":315,"progress":0,"start_date":"2019-04-01 00:00:00","parent":0,"owner":"Aleksandrs","timestamps":{"date":"2019-02-18 15:26:39.000000","timezone_type":3,"timezone":"UTC"},"favorites":false,"group_id":null,"team_managers":[],"subcontractor":[],"subcontractor_managers":[],"open":true}],"links":[{"id":1,"type":"1","source":1,"target":2,"timestamps":{"date":"2019-02-01 16:24:04.000000","timezone_type":3,"timezone":"UTC"},"open":true},{"id":3,"type":"1","source":7,"target":8,"timestamps":{"date":"2019-02-01 16:26:29.000000","timezone_type":3,"timezone":"UTC"},"open":true},{"id":6,"type":"1","source":9,"target":10,"timestamps":{"date":"2019-02-01 16:27:08.000000","timezone_type":3,"timezone":"UTC"},"open":true},{"id":7,"type":"1","source":8,"target":9,"timestamps":{"date":"2019-02-01 16:27:11.000000","timezone_type":3,"timezone":"UTC"},"open":true},{"id":9,"type":"0","source":43,"target":3,"timestamps":{"date":"2019-02-07 14:42:29.000000","timezone_type":3,"timezone":"UTC"},"open":true},{"id":10,"type":"0","source":33,"target":36,"timestamps":{"date":"2019-02-08 02:25:30.000000","timezone_type":3,"timezone":"UTC"},"open":true},{"id":12,"type":"0","source":9,"target":10,"timestamps":{"date":"2019-02-12 10:28:04.000000","timezone_type":3,"timezone":"UTC"},"open":true},{"id":13,"type":"0","source":9,"target":11,"timestamps":{"date":"2019-02-12 10:28:10.000000","timezone_type":3,"timezone":"UTC"},"open":true},{"id":14,"type":"0","source":43,"target":10,"timestamps":{"date":"2019-02-12 12:00:54.000000","timezone_type":3,"timezone":"UTC"},"open":true}]}
;

class App extends Component {
  constructor(props) {
    super(props);
    this.state = {
      currentZoom: 'Days',
      messages: []
    };

    this.handleZoomChange = this.handleZoomChange.bind(this);
    this.logTaskUpdate = this.logTaskUpdate.bind(this);
    this.logLinkUpdate = this.logLinkUpdate.bind(this);
  }
  
  addMessage(message) {
    var messages = this.state.messages.slice();
    var prevKey = messages.length ? messages[0].key: 0;

    messages.unshift({key: prevKey + 1, message});
    if(messages.length > 40){
      messages.pop();
    }
    this.setState({messages});
  }

  logTaskUpdate(id, mode, task) {
    let text = task && task.text ? ` (${task.text})`: '';
    let message = `Task ${mode}: ${id} ${text}`;
    this.addMessage(message);
  }

  logLinkUpdate(id, mode, link) {
    let message = `Link ${mode}: ${id}`;
    if (link) {
      message += ` ( source: ${link.source}, target: ${link.target} )`;
    }
    this.addMessage(message)
  }

  handleZoomChange(zoom) {
    this.setState({
      currentZoom: zoom
    });
  }  
  
  render() {
    return (
      <div>
        <Toolbar
            zoom={this.state.currentZoom}
            onZoomChange={this.handleZoomChange}
        />
        <div className="gantt-container">
          <Gantt
            tasks={data}
            zoom={this.state.currentZoom}
            onTaskUpdated={this.logTaskUpdate}
            onLinkUpdated={this.logLinkUpdate}
          />
        </div>
        <MessageArea
            messages={this.state.messages}
        />
      </div>
    );
  }
}
export default App;
